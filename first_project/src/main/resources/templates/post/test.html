<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
    />
    <link
            href="https://font.elice.io/css?family=Elice+DX+Neolli"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <style>
        html,
        body {
          font-family: "Elice DX Neolli", sans-serif;
        }

        .dropdown-toggle:after {
          content: none;
        }

        .comment .btn-group {
          display: none;
        }

        .comment:hover .btn-group {
          display: flex;
        }
    </style>
    <title>임시</title>
</head>
<body>
<hr class="mt-4" />
<h4 class="mb-3">
    댓글
    <small
            class="text-secondary"
            id="commentsCount"
            th:text="${comments.size()}"
    >0</small
    >
</h4>
<div
        class="container p-0 d-flex flex-column align-items-start gap-2"
        th:unless="${#lists.isEmpty(comments)}"
>
    <div
            class="card comment"
            style="min-width: 30%"
            th:each="comment : ${comments}"
    >
        <div class="card-body position-relative">
            <p class="mb-2" th:text="${comment.content}">댓글 내용</p>
            <small class="text-secondary">2024-01-04T13:21:21</small>

            <div
                    class="position-absolute end-0 top-50 translate-middle-y mb-3 me-3 btn-group bg-white bg-opacity-75"
                    role="group"
                    aria-label="edit-delete"
            >
                <button
                        class="btn btn-outline-primary lh-1"
                        data-bs-toggle="modal"
                        data-bs-target="#editCommentModal"
                        th:onclick="handleEditCommentButton(event, [[${comment.id}]], [[${comment.content}]]);"
                >
                    <span class="material-symbols-outlined"> edit </span>
                </button>
                <button
                        class="btn btn-outline-danger lh-1"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteCommentModal"
                        th:onclick="handleDeleteCommentButton(event, [[${comment.id}]]);"
                >
                    <span class="material-symbols-outlined"> delete </span>
                </button>
            </div>
        </div>
    </div>
</div>
<span
        th:if="${#lists.isEmpty(comments)}"
        class="d-block w-100 text-center"
>댓글이 없습니다.</span
>
<!--<form-->
<!--        class="mt-3 row"-->
<!--        th:action="@{/comments(postId=${post.id})}"-->
<!--        method="POST"-->
<!--&gt;-->
<!--    <div class="input-group">-->
<!--            <textarea-->
<!--                    class="form-control"-->
<!--                    name="content"-->
<!--                    cols="6"-->
<!--                    placeholder="댓글 작성하기"-->
<!--            ></textarea>-->
<!--        <button class="btn btn-primary">업로드</button>-->
<!--    </div>-->
<!--</form>-->

<!-- 부트스트랩 JS 추가 -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"
></script>
<script th:inline="javascript">
    let currentPost;
    let currentBoard;
    let currentComment;
    let elementToDelete;

    function handleDeletePostButton(_, postId, boardId) {
      currentPost = postId;
      currentBoard = boardId;
    }

    function handleDeletePostModalButton() {
      fetch(`/posts/${currentPost}`, {
        method: "DELETE",
      }).then(() => (window.location.href = `/boards/${currentBoard}`));
    }

    function handleDeleteCommentButton(e, commentId) {
      currentComment = commentId;
      elementToDelete = e.target.closest(".card");
    }

    function handleDeleteCommentModalButton() {
      fetch(`/comments/${currentComment}`, {
        method: "DELETE",
      }).then(() => elementToDelete.remove());

      const commentsCount = document.getElementById("commentsCount");
      commentsCount.innerText = parseInt(commentsCount.innerText) - 1;

      const modal = bootstrap.Modal.getInstance("#deleteCommentModal");
      modal.hide();
    }

    function handleEditCommentButton(_, commentId, content) {
      document.getElementById("commentContentTextarea").innerText = content;
      document
        .getElementById("commentEditForm")
        .setAttribute("action", `/comments/${commentId}/edit`);
    }
</script>
</body>
</html>
